#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import json

from .... import TestUnitBase


class TestDotNetDeserializer(TestUnitBase):

    def test_real_world_01(self):
        unit = self.load(encoder='hex')
        data = bytes.fromhex('0001000000'
            'FFFFFFFF01000000000000000C020000005153797374656D2E44726177696E67'
            '2C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472'
            '616C2C205075626C69634B6579546F6B656E3D62303366356637663131643530'
            '61336105010000001553797374656D2E44726177696E672E4269746D61700100'
            '0000044461746107020200000009030000000F030000000B0200000289504E47'
            '0D0A1A0A0000000D49484452000000100000001008060000001FF3FF61000000'
            '0467414D410000B18F0BFC6105000000206348524D00007A26000080840000FA'
            '00000080E8000075300000EA6000003A98000017709CBA513C00000196494441'
            '54384FA5D3DD2B43711CC7F1EF1FC1855C892492A7927B97FE0192A724CF2486'
            '3FC0AD851042CDC86373B6338C1592137B10172B93D6C43666C330EC6EBE1F36'
            '1D0F17A75CBCFAAEDF7EEFDFF99DDA281A8DFE0B15F4980B590B667EF7162921'
            '6FB0D0CA27D93159B9425F0DE5A9368B58FB84D9A5F187225625B0170D5ACAED'
            '3241E54D2862B908BC9895C05E346829A77303AA7D0F6F072E7FD8A404F6A241'
            '4BD91D6B5073197C95CE7CCFEB728EAB47E1F0FC4EBBE3B81D339D5C0F1A8F7C'
            '6AB0B9EEE7D1A0A5AC76116ADDB72F7B1C8870EC0EE9B61DFE49BDCD3B2058BD'
            'EA4F1EF56A8C74169C43839632DB0C50777E13DE3DBE0809FBCEE01C87C33A8B'
            '6788370FC9671CEF59408396325A04A83FF53E6DF355B582CD3BCA4F84913F7C'
            '7C2739834B68D0527A930E1AEDAEFB0DBEE6043F6D9CE737588BAF634ACE800E'
            '0D5A4AAD5FA6B48695667E2F039F3E2D3315F3EB33DF408F062DA5D42D16B3BE'
            'DE99A3593EC41823FE987222F6A2414BC955DA7EFC2C31994AA1AF8612CBA64A'
            '124A274730932A34A484BCF9F32FAA5C94DE01ABC3866882C215F60000000049'
            '454E44AE4260820B')
        parsed = json.loads(unit(data))
        self.assertEqual(len(parsed), 3)
        self.assertEqual(
            parsed[1]['Data']['LibraryName'],
            'System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a'
        )
        self.assertEqual(
            parsed[2]['Data']['ClassInfo']['ClassName'],
            'System.Drawing.Bitmap'
        )
        self.assertEqual(
            bytes.fromhex(parsed[2]['Data']['Members']['Data'])[:6],
            B'\x89PNG\r\n'
        )
